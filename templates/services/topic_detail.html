{% extends "base.html" %}
{% load static i18n %}
{% load mptt_tags %}
{% load service_extras %}

{% block title %}User: {{ object.username }}{% endblock %}

{% block css %}
    {{ block.super }}
    <link href="{% static 'css/comments.css' %}" rel="stylesheet">

{% endblock %}

{% block content %}

<div class="container">
  <div class="row">
    <div class="col-sm-10 col-sm-offset-1" id="logout">
        <div class="page-header">

            <!-- The topic details -->
            <!-- ---------------------------------------------- -->
            <div class="table-reponsive">
                <table class="table">
                  <tbody>
                      {% include 'home/partial/topic_description.html' %}
                  </tbody>
                </table>
            </div>
        </div>

            <!-- Comments on topic -->
            <!-- ---------------------------------------------- -->
        <div class="comment-tabs">
            <ul class="nav nav-tabs" role="tablist">
                <li class="active"><a href="#comments-logout" role="tab" data-toggle="tab"><h4 class="reviews text-capitalize">Comments</h4></a></li>
                <li><a href="#add-comment" role="tab" data-toggle="tab"><h4 class="reviews text-capitalize">Add comment</h4></a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="comments-logout">
                    <ul class="media-list">

                      <li class="media">
                      {% recursetree comments %}
                        <a class="pull-left" href="{% url 'users:detail' node.user.username %}">
                          <img class="media-object img-circle" src="{% if node.user.profile_picture %} {{ node.user.profile_picture }} {% else %} https://www.wallstreetotc.com/wp-content/uploads/2014/10/facebook-anonymous-app.jpg {% endif %}" alt="profile">
                        </a>
                        <div class="media-body">
                          <div class="well well-lg">
                              <h4 class="media-heading text-uppercase reviews">{{ node.user.username }}</h4>
                              <ul class="media-date text-uppercase reviews list-inline">
                                {{ node.created_at | timesince | up_to:',' }} <small>ago</small>
                              </ul>
                              <p class="media-comment">
                                {{ node.content }}
                              </p>

                              <a class="btn btn-info btn-circle text-uppercase reply" data-toggle="modal" data-target="#reply_modal" comment_id="{{ node.id }}" href="#"><span class="glyphicon glyphicon-share-alt"></span> Reply</a>
                              {% if node.subcomment_count > 0 %}<a class="btn btn-warning btn-circle text-uppercase" data-toggle="collapse" href="#reply{{node.id}}"><span class="glyphicon glyphicon-comment"></span> {{ node.subcomment_count }} comments</a>{% endif %}
                              <div id="cscore_{{node.id}}" style="font-size:1em;" class="upvote_comment pull-right">
                                  {% if not node.up_voted and user.is_authenticated %}<button class="fa fa-thumbs-up" title="upvote"></button> {% endif %}<span upvotes="{{ node.up_votes }}">({{ node.up_votes }})</span>
                              </div>
                          </div>
                        </div>
                      {% if not node.is_leaf_node %}
                        <div class="collapse" id="reply{{node.id}}">
                            <ul class="media-list">
                                <li class="media media-replied">
                                    {{ children }}
                                </li>
                            </ul>
                        </div>
                      {% endif %}
                      {% endrecursetree %}
                      </li>

                    </ul>
                </div>
                <div class="tab-pane" id="add-comment">
                    {% include "services/partial/comment_form.html" with form_type='comment' %}
                </div>
            </div>
        </div>
	</div>
  </div>
</div>

{% endblock %}

{% block modal %}
    {{ block.super }}

    <!-- Modal -->
    <div class="modal fade" id="reply_modal" tabindex="-1" role="dialog" aria-labelledby="ReplyModal" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="ReplyModalLabel">Reply</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
              {% include "services/partial/comment_form.html" with form_type='reply' %}
          </div>
        </div>
      </div>
    </div>

{% endblock %}

{% block javascript %}
    {{ block.super }}
    <script>
        var url_upvote_topic = "{% url 'services:topic_upvote' %}"
        var url_upvote_comment = "{% url 'services:comment_upvote' %}"
    </script>
    <!-- Additional JS to add here -->
    <script src="{% static 'js/upvotes.js' %}"></script>
    <script>
    $(document).ready(function() {
        $(".reply").click(function() {
            $("#comment_parent").val($(this).attr('comment_id'))
        });
    });
    </script>
{% endblock javascript %}